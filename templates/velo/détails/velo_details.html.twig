{% extends 'base.html.twig' %}

{% block title %}Détails du Vélo{% endblock %}
{% block body %}
    <div class="details-container">
        <div class="column-left"> <!-- Ajout de la classe column-left -->
            <h1>Détails du Vélo</h1>
            <ul class="details-list">
                <li>Marque: <span id="marque">{{ velo.marque }}</span></li>
                <li>Numéro de série: <span id="numero_de_serie">{{ velo.getNumeroDeSerie() }}</span></li>
                <li>Référence recyclerie: <span id="ref_recyclerie">{{ velo.getRefRecyclerie() }}</span></li>
                <li>Couleur: <span id="couleur">{{ velo.couleur }}</span></li>
                <li>Poids: <span id="poids">{{ velo.poids }}</span></li>
                <li>Taille des Roues: <span id="taille_roues">{{ velo.getTailleRoues() }}</span></li>
                <li>État: <span id="etat">{{ velo.etat }}</span></li>
                <li>Origine du vélo: <span id="origine">{{ velo.getOrigine() }}</span></li>
                <li>Date de Réception: <span id="date_de_reception">{{ velo.getDateDeReception()|date('Y-m-d') }}</span></li>


            </ul>
        </div>
        <div class="column-right"> <!-- Ajout de la classe column-right -->
            <ul class="details-list">
                <li>Taille du Cadre: <span id="taille_cadre">{{ velo.getTailleCadre() }}</span></li>
                <li>URL Photo: <a href="{{ velo.getUrlPhoto() }}" target="_blank">Voir la photo</a></li>

                <li>Date de Vente: <span id="date_de_vente">{{ velo.getDateDeVente()|date('Y-m-d') }}</span></li>
                <li>Type: <span id="type">{{ velo.type }}</span></li>
                <li>Emplacement: <span id="emplacement">{{ velo.emplacement }}</span></li>
                <li>Commentaire: <span id="commentaire">{{ velo.commentaire }}</span></li>
                <li>Propriétaire ID: <span id="proprietaire_id">{{ velo.getProprietaire().getId() }}</span></li>
                <li>Public: <span id="public">{{ velo.getPublic() }}</span></li>
                <li>Date de Destruction: <span id="date_destruction">{{ velo.getDateDestruction()|date('Y-m-d') }}</span></li>
            </ul>
        </div>
    </div>
    <div class="button-container">
        <a href="{{ path('app_accueil') }}" class="back-to-home">Retour à l'accueil</a>
        <button type="button" class="btn btn-primary edit-button">Modifier</button>
        <button type="submit" class="btn btn-success save-button">Enregistrer</button>
    </div>
{% endblock %}


{% block javascripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let editMode = false;
            const editButton = document.querySelector('.edit-button');
            const saveButton = document.querySelector('.btn-success');
            const fields = document.querySelectorAll('.details-list span');

            editButton.addEventListener('click', function() {
                editMode = !editMode;
                fields.forEach(field => {
                    field.setAttribute('contenteditable', editMode ? 'true' : 'false');
                });
            });


             //data contient les nouvelles valeurs modifiés

            saveButton.addEventListener('click', function() {
                if (editMode) {
                    const data = {};
                    fields.forEach(field => {
                        if (field.getAttribute('contenteditable') === 'true') {
                            let propName = field.id;
                            // Convertissez l'ID de snake_case en camelCase
                            propName = propName.replace(/_([a-z])/g, function (g) { return g[1].toUpperCase(); });
                            data[propName] = field.innerText;
                        }
                    });
                    //trouve la route du controlleur pour envoyer les donner enregistrés avec post

                    fetch(`/api/update-velo/{{ velo.id }}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-Token': '{{ csrf_token('edit_velo') }}'
                        },
                        body: JSON.stringify(data)
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Something went wrong on the server!');
                            }
                            return response.json();
                        })
                        .then(responseData => {
                            console.log('Data saved successfully:', responseData);
                            // Additional UI feedback can be added here
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }
            });
        });

    </script>
{% endblock %}


{% block stylesheets %}
    <style>
        .details-container {
            display: flex;
            gap: 20px; /* Espace entre les colonnes */
            background-color: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            max-width: 1000px;
            margin: 20px auto;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            align-items: stretch; /* Les colonnes s'étirent pour avoir la même hauteur */
        }

        .column-left, .column-right {
            flex: 1; /* Chaque colonne prend la même quantité d'espace disponible */
        }

        .details-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .column-right {
            margin-top: 83px; /* Ajoute une marge supérieure pour décaler la colonne de droite vers le bas */
        }

        .details-list li {
            background-color: #eef7ee;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #d4e8d4;
        }

        .button-container {
            display: flex;
            justify-content: center; /* Centrer les éléments horizontalement */
            align-items: flex-end; /* Aligner les éléments en bas de leur conteneur */
            margin-top: 20px; /* Espacement entre les boutons et le contenu précédent */
        }

        .back-to-home, .edit-button, .save-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px; /* Espace avant les boutons */
        }

        .back-to-home:hover, .edit-button:hover, .save-button:hover {
            background-color: #368B2F;
        }

        a {
            color: #217346;
            text-decoration: none;
        }

        a:hover {
            color: #0f5132;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .details-container {
                flex-direction: column; /* Sur les petits écrans, afficher les colonnes les unes en dessous des autres */
            }

            .column-left, .column-right {
                width: 100%; /* Chaque colonne prend toute la largeur sur les petits écrans */
            }
        }


         span[contenteditable="true"] {
             background-color: #ffffe0; /* Jaune clair pour indiquer l'édition */
             outline: 2px solid #4caf50; /* Bordure verte pour mieux voir les champs éditables */
             padding: 3px; /* Un peu de padding pour que le texte ne touche pas les bords */
             cursor: text; /* Change le curseur pour indiquer qu'on peut éditer */
         }
    </style>




    </style>
{% endblock %}