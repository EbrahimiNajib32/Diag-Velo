{% extends 'base.html.twig' %}

{% block body %}
    <div class="container mx-auto px-4 text-center ">


        {{ form_start(form) }}
        <h1 class="text-2xl font-bold my-4">Créer un nouveau type de diagnostic</h1>
        <div class="mb-4">
            <h3>Nom du type de diagnostic</h3>
            {{ form_widget(form.nomType, {'attr': {'class': 'w-full p-2 border border-gray-300 rounded'}}) }}
        </div>

        <h2 class="text-xl font-semibold my-2">Elements de Contrôle</h2>
        <div id="elements-list">
            {% for category, elements in elementsByCategory %}
                <div class="category mb-4">
                    <div class="category-header flex items-center toggle-category  justify-between bg-gray-100 p-2 rounded">
                        <i class="bi bi-chevron-down"></i>
                        <h1>{{ category }}</h1>
                        <div class="flex items-center">
                            <input type="checkbox" class="select-all-checkbox mr-2" data-category="{{ category }}">
                        </div>
                    </div>
                    <div class="category-elements mt-2 ml-4" style="display: none;">
                        {% for element in elements %}
                            <div class="element flex text-center items-center mb-2">
                                <input type="checkbox" name="elements[]" value="{{ element.id }}" class="element-checkbox mr-2" data-category="{{ category }}">
                                <label>{{ element.element }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="mt-4">
            <button type="submit" class="bg-teal-500 text-white py-2 px-4 rounded hover:bg-teal-600">Créer</button>
        </div>
        {{ form_end(form) }}
    </div>
    <div class="mt-6 flex justify-center">
        <a href="{{ path('app_type_diagnostic_liste') }}" class="button-style hover:bg-green-400"><i class="bi bi-box-arrow-left text-xl"></i> Retour liste type de diagnostics</a>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.toggle-category').forEach(button => {
                button.addEventListener('click', function () {
                    var categoryElements = this.closest('.category').querySelector('.category-elements');
                    categoryElements.style.display = categoryElements.style.display === 'none' ? 'block' : 'none';
                });
            });

            document.querySelectorAll('.select-all-checkbox').forEach(selectAllCheckbox => {
                selectAllCheckbox.addEventListener('change', function () {
                    var category = this.getAttribute('data-category');
                    var checkboxes = document.querySelectorAll(`.element-checkbox[data-category="${category}"]`);
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                });
            });

            document.querySelectorAll('.element-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    var category = this.getAttribute('data-category');
                    var allCheckboxes = document.querySelectorAll(`.element-checkbox[data-category="${category}"]`);
                    var selectAllCheckbox = document.querySelector(`.select-all-checkbox[data-category="${category}"]`);
                    var allChecked = Array.from(allCheckboxes).every(cb => cb.checked);
                    selectAllCheckbox.checked = allChecked;
                });
            });
        });
    </script>
{% endblock %}
