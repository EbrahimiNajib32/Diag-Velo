{% extends 'base.html.twig' %}

{% block body %}
    <div class="container shadow-2xl p-2 mt-3 mx-auto px-4 max-w-lg ">
        <h1 class="text-xl font-semibold text-gray-700 text-center portrait:text-3xl">Nouveau Diagnostic</h1>
        {{ form_start(diagnosticForm, {'attr': {'class': 'space-y-3 portrait:space-y-6'}}) }}


        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 border">
            <div>{{ form_row(diagnosticForm.date_diagnostic, {'attr': {'class': 'form-control border mt-2'}}) }}</div>
            <div>{{ form_row(diagnosticForm.cout_reparation, {'attr': {'class': 'form-control border mt-2'}}) }}</div>
            <div>{{ form_row(diagnosticForm.velo, {'attr': {'class': 'form-control border m-2'}}) }}</div>
            <div>{{ form_row(diagnosticForm.utilisateur, {'attr': {'class': 'form-control border m-2'}}) }}</div>
            <div class="col-span-1 md:col-span-2">{{ form_row(diagnosticForm.conclusion, {'attr': {'class': 'form-control border mb-2'}}) }}</div>
        </div>


        {% for category, elements in diagnosticElements %}
            <div class="mb-2 text-center">
                <h2 onclick="toggleSection(event)" class="text-lg font-semibold cursor-pointer bg-red-500 rounded-xl text-black portrait:text-3xl" aria-expanded="false">
                    {{ category }}
                </h2>
                <div class="mt-2 bg-gray-100 p-2 rounded shadow hidden transition-all ease-in-out duration-300 portrait:text-2xl">
                    {% for element in elements %}
                        <div class="form-group">
                            {{ form_label(attribute(diagnosticForm, 'etat_' ~ element.id)) }}
                            {{ form_widget(attribute(diagnosticForm, 'etat_' ~ element.id), {'attr': {'class': 'form-control'}}) }}
                            {{ form_errors(attribute(diagnosticForm, 'etat_' ~ element.id)) }}


                            {{ form_label(attribute(diagnosticForm, 'commentaire_' ~ element.id)) }}
                            {{ form_widget(attribute(diagnosticForm, 'commentaire_' ~ element.id), {'attr': {'class': 'form-control'}}) }}
                            {{ form_errors(attribute(diagnosticForm, 'commentaire_' ~ element.id)) }}
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}

        <button type="submit" class="mt-4 py-2 px-4 bg-teal-500 hover:bg-indigo-700 text-white font-medium rounded-md">Soumettre</button>
        {{ form_end(diagnosticForm) }}
    </div>

    <script>
        function toggleSection(event) {
            const section = event.currentTarget.nextElementSibling;
            const expanded = event.currentTarget.getAttribute('aria-expanded') === 'true' || false;
            event.currentTarget.setAttribute('aria-expanded', !expanded);
            section.classList.toggle('hidden');
        }
    </script>
{% endblock %}